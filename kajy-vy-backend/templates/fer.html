{% extends "base.html" %}

{% block main %}
<main class="container" style="padding: 30px;">
 
  <div style="background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">

      <div class="btn-group btn-group-toggle mb-3" data-toggle="buttons">
      <label class="btn btn-outline-dark active">Cadre Porte & Fenêtre
        <input type="radio" id="btnradio1" name="btnradio" />
      </label>
      <label class="btn btn-outline-dark">Cadre Grille de protection
        <input type="radio" id="btnradio-2" name="btnradio" />
      </label>
      <label class="btn btn-outline-dark">Bâti Porte & Fenêtre
        <input type="radio" id="btnradio-3" name="btnradio" />
      </label>
      <label class="btn btn-outline-dark">Décoration Grille de protection
        <input type="radio" id="btnradio-4" name="btnradio" />
      </label>
      <label class="btn btn-outline-dark">Tôle
        <input type="radio" id="btnradio-5" name="btnradio" />
      </label>
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="mb-4">
      <button id="btn-ajouter" class="btn btn-success" style="background-color: gray;border-color: gray;">
        <i class="fas fa-plus"></i> Ajouter
      </button>
    </div>

    <div id="section-cadre" class="section-content active">
      <table class="table table-striped">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Prix de la peinture</th>
            <th>Prix du type</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for cadre in cadres %}
          <tr>
            <td>{{ cadre.id_cadre }}</td>
            <td>{{ cadre.type_cadre }}</td>
            <td>{{ cadre.prix_peinture }}</td>
            <td>{{ cadre.prix_type }}</td>
            <td>
              <a href="/Admin-Fer/modifier/cadre/{{ cadre.id_cadre }}" class="btn btn-sm btn-primary">Modifier</a>
              <form action="/Admin-Fer/supprimer/cadre/{{ cadre.id_cadre }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger"
                  onclick="return confirm('Supprimer ?');">Supprimer</button>
              </form>
            </td>
          </tr>
          {% if cadre_edit and cadre_edit.id_cadre == cadre.id_cadre %} <tr>
            <td colspan="5">
              <form action="/Admin-Fer/modifier/cadre/{{ cadre.id_cadre }}" method="POST" class="form-inline"> <input
                  type="text" name="type_cadre" class="form-control mr-2" value="{{ cadre_edit.type_cadre }}" required>
                <input type="number" step="0.01" min="0" name="prix_peinture" class="form-control mr-2"
                  value="{{ cadre_edit.prix_peinture }}" required> <input type="number" step="0.01" min="0"name="prix_type"
                  class="form-control mr-2" value="{{ cadre_edit.prix_type }}" required> <button type="submit"
                  class="btn btn-success btn-sm" style="background-color: #6c757d;border-color: #6c757d;">Enregistrer</button>
              </form>
            </td>
          </tr>
          {% endif %}
          {% else %}
          <tr>
            <td colspan="5" class="text-muted">Aucun cadre trouvé</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div id="section-grille" class="section-content">
      <table class="table table-striped">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Prix de la peinture</th>
            <th>Prix du type</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for grille in cadres_grille %}
          <tr>
            <td>{{ grille.id_grille }}</td>
            <td>{{ grille.type_cadre }}</td>
            <td>{{ grille.prix_peinture }}</td>
            <td>{{ grille.prix_type }}</td>
            <td>
              <a href="/Admin-Fer/modifier/cadre-grille/{{ grille.id_grille }}"
                class="btn btn-sm btn-primary">Modifier</a>
              <form action="/Admin-Fer/supprimer/cadre-grille/{{ grille.id_grille }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger"
                  onclick="return confirm('Supprimer ?');">Supprimer</button>
              </form>
            </td>
          </tr>
          {% if cadre_grille_edit and cadre_grille_edit.id_grille == grille.id_grille %} <tr>
            <td colspan="5">
              <form action="/Admin-Fer/modifier/cadre-grille/{{ grille.id_grille }}" method="POST" class="form-inline">
                <input type="text" name="type_cadre" class="form-control mr-2"
                  value="{{ cadre_grille_edit.type_cadre }}" required> <input type="number" step="0.01" min="0"
                  name="prix_peinture" class="form-control mr-2" value="{{ cadre_grille_edit.prix_peinture }}" required>
                <input type="number" step="0.01" min="0"name="prix_type" class="form-control mr-2"
                  value="{{ cadre_grille_edit.prix_type }}" required> <button type="submit"
                  class="btn btn-success btn-sm" style="background-color: #6c757d;border-color: #6c757d;">Enregistrer</button>
              </form>
            </td>
          </tr> {% endif %}
          {% else %}
          <tr>
            <td colspan="5" class="text-muted">Aucun cadre grille trouvé</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div id="section-bati" class="section-content">
      <table class="table table-striped">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Prix de la peinture</th>
            <th>Prix du type</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for bati in batis %}
          <tr>
            <td>{{ bati.id_bati }}</td>
            <td>{{ bati.type_bati }}</td>
            <td>{{ bati.prix_peinture }}</td>
            <td>{{ bati.prix_type }}</td>
            <td>
              <a href="/Admin-Fer/modifier/batis/{{ bati.id_bati }}" class="btn btn-sm btn-primary">Modifier</a>
              <form action="/Admin-Fer/supprimer/bati/{{ bati.id_bati }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger"
                  onclick="return confirm('Supprimer ?');">Supprimer</button>
              </form>
            </td>
          </tr>
          {% if bati_edit and bati_edit.id_bati == bati.id_bati %} <tr>
            <td colspan="5">
              <form action="/Admin-Fer/modifier/batis/{{ bati.id_bati }}" method="POST" class="form-inline"> <input
                  type="text" name="type_bati" class="form-control mr-2" value="{{ bati_edit.type_bati }}" required>
                <input type="number" step="0.01" min="0"name="prix_peinture" class="form-control mr-2"
                  value="{{ bati_edit.prix_peinture }}" required> <input type="number" step="0.01" min="0" name="prix_type"
                  class="form-control mr-2" value="{{ bati_edit.prix_type }}" required> <button type="submit"
                  class="btn btn-success btn-sm" style="background-color: #6c757d;border-color: #6c757d;">Enregistrer</button> </form>
            </td>
          </tr> {% endif %}
          {% else %}
          <tr>
            <td colspan="5" class="text-muted">Aucun bâti trouvé</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div id="section-decoration" class="section-content">
      <table class="table table-striped">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Prix de la peinture</th>
            <th>Prix du type</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for deco in decorations %}
          <tr>
            <td>{{ deco.id_decoration }}</td>
            <td>{{ deco.type_decoration }}</td>
            <td>{{ deco.prix_peinture }}</td>
            <td>{{ deco.prix_type }}</td>
            <td>
              <a href="/Admin-Fer/modifier/decoration/{{ deco.id_decoration }}"
                class="btn btn-sm btn-primary">Modifier</a>
              <form action="/Admin-Fer/supprimer/decoration/{{ deco.id_decoration }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger"
                  onclick="return confirm('Supprimer ?');">Supprimer</button>
              </form>
            </td>
          </tr>
          {% if deco_edit and deco_edit.id_decoration == deco.id_decoration %} <tr>
            <td colspan="5">
              <form action="/Admin-Fer/modifier/decoration/{{ deco.id_decoration }}" method="POST" class="form-inline">
                <input type="text" name="type_decoration" class="form-control mr-2"
                  value="{{ deco_edit.type_decoration }}" required> <input type="number" step="0.01" min="0"
                  name="prix_peinture" class="form-control mr-2" value="{{ deco_edit.prix_peinture }}" required> <input
                  type="number" step="0.01" min="0" name="prix_type" class="form-control mr-2" value="{{ deco_edit.prix_type }}"
                  required> <button type="submit" class="btn btn-success btn-sm" style="background-color: #6c757d;border-color: #6c757d;">Enregistrer</button>
              </form>
            </td>
          </tr> {% endif %}
          {% else %}
          <tr>
            <td colspan="5" class="text-muted">Aucune décoration trouvée</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div id="section-tole" class="section-content">
      <table class="table table-striped">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Prix de la peinture</th>
            <th>Prix du type</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for tole in toles %}
          <tr>
            <td>{{ tole.id_tole }}</td>
            <td>{{ tole.type_tole }}</td>
            <td>{{ tole.prix_peinture }}</td>
            <td>{{ tole.prix_type }}</td>
            <td>
              <a href="/Admin-Fer/modifier/toles/{{ tole.id_tole }}" class="btn btn-sm btn-primary">Modifier</a>
              <form action="/Admin-Fer/supprimer/toles/{{ tole.id_tole }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger"
                  onclick="return confirm('Supprimer ?');">Supprimer</button>
              </form>
            </td>
          </tr>
          {% if tole_edit and tole_edit.id_tole == tole.id_tole %} <tr>
            <td colspan="5">
              <form action="/Admin-Fer/modifier/toles/{{ tole.id_tole }}" method="POST" class="form-inline"> <input
                  type="text" name="type_tole" class="form-control mr-2" value="{{ tole_edit.type_tole }}" required>
                <input type="number" step="0.01" min="0" name="prix_peinture" class="form-control mr-2"
                  value="{{ tole_edit.prix_peinture }}" required> <input type="number" step="0.01" min="0" name="prix_type"
                  class="form-control mr-2" value="{{ tole_edit.prix_type }}" required> <button type="submit"
                  class="btn btn-success btn-sm" style="background-color: #6c757d;border-color: #6c757d;">Enregistrer</button> </form>
            </td>
          </tr> {% endif %}
          {% else %}
          <tr>
            <td colspan="5" class="text-muted">Aucune tôle trouvée</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addModalLabel">Ajouter une nouvelle référence</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form id="addForm" method="POST">
          <div class="modal-body">
            <div class="form-group">
              <label for="type_reference">Type de référence</label>
              <input type="text" class="form-control" id="type_reference" name="type_reference" required>
            </div>
            <div class="form-group">
              <label for="prix_peinture">Prix de la peinture</label>
              <input type="number" step="0.01" min="0" class="form-control" id="prix_peinture" name="prix_peinture" required>
            </div>
            <div class="form-group">
              <label for="prix_type">Prix du type</label>
              <input type="number" step="0.01" min="0" class="form-control" id="prix_type" name="prix_type" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Annuler</button>
            <button type="submit" class="btn btn-secondary" style=" background: linear-gradient(135deg, #6c757d 0%, #495057 100%);" >Ajouter</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</main>

<style>
  .section-content {
    display: none;
  }
  .section-content.active {
    display: block;
  }
  .btn-group .btn-outline-dark.active {
    background-color: black !important;
    border-color: black !important;
    color: white !important;
  }

  .btn-group .btn-outline-dark:hover {
    background-color: black;
    border-color: black;
    color: white;
  }
  .btn-group .btn-outline-dark {
    border-color: black;
    color: black;
  }
  .btn-group {
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
  }
  .btn-group .btn {
    font-weight: 500;
    padding: 12px 20px;
    border-radius: 0;
    transition: all 0.3s ease;
  }

  .btn-group .btn:first-child {
    border-top-left-radius: 8px;
    border-bottom-left-radius: 8px;
  }
  .btn-group .btn:last-child {
    border-top-right-radius: 8px;
    border-bottom-right-radius: 8px;
  }

   #btn-ajouter {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
  }
#btn-ajouter:hover {
    transform: translateY(-2px);
  }
  
  .table {
    border-radius: 10px;
    overflow: hidden;
    
    background: white;
  }
  .table thead th {
    background: linear-gradient(135deg, #343a40 0%, #495057 100%);
    border: none;
    color: white;
    font-weight: 600;
   
    font-size: 0.85rem;
    letter-spacing: 0.5px;
    padding: 15px 12px;
  }
.table tbody tr {
    transition: all 0.3s ease;
  }

  .table tbody td {
    padding: 12px;
    vertical-align: middle;
    border-color: rgba(0, 0, 0, 0.05);
  }

  .btn-sm {
    padding: 6px 12px;
    border-radius: 6px;
    font-weight: 500;
    transition: all 0.3s ease;
    margin: 0 2px;
  }

  .btn-primary {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    border: none;
  }

  .btn-primary:hover {
    transform: translateY(-1px);
    
  }

  .btn-danger {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    border: none; 
  }

  .btn-danger:hover {
    transform: translateY(-1px);
   
  }
.alert {
    border: none;
    border-radius: 10px;
    padding: 15px 20px;
    margin-bottom: 20px;
  }

  .alert-success {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    color: #155724;
  }

  .alert-danger {
    background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    color: #721c24;
  }
  @media (max-width: 768px) {
    .btn-group {
      flex-direction: column;
    }
    
    .btn-group .btn {
      border-radius: 8px !important;
      margin-bottom: 5px;
    }
    
    .table-responsive {
      font-size: 0.9rem;
    }
    
    .form-inline {
      flex-direction: column;
    }
    
    .form-inline .form-control,
    .form-inline .btn {
      width: 100%;
      margin-right: 0;
    }
  }

</style>

<script>
 document.addEventListener('DOMContentLoaded', function () {
  const radioButtons = document.querySelectorAll('input[name="btnradio"]');
  const sections = {
    'btnradio1': 'section-cadre',
    'btnradio-2': 'section-grille',
    'btnradio-3': 'section-bati',
    'btnradio-4': 'section-decoration',
    'btnradio-5': 'section-tole'
  };

 
  const sectionToRadio = {
    'cadre': 'btnradio1',
    'grille': 'btnradio-2',
    'bati': 'btnradio-3',
    'decoration': 'btnradio-4',
    'tole': 'btnradio-5'
  };

  function showSection(radioId) {
    document.querySelectorAll('.section-content').forEach(section => {
      section.classList.remove('active');
    });

    const targetSection = document.getElementById(sections[radioId]);
    if (targetSection) {
      targetSection.classList.add('active');
    }
  }

  radioButtons.forEach(radio => {
    radio.addEventListener('change', function () {
      if (this.checked) {
        showSection(this.id);
        document.querySelectorAll('.btn-group label').forEach(label => {
          label.classList.remove('active');
        });
        this.closest('label').classList.add('active');
      }
    });
  });

  document.getElementById('btn-ajouter').addEventListener('click', function () {
    const activeSection = document.querySelector('.section-content.active');
    const sectionId = activeSection.id;

    const sectionConfig = {
      'section-cadre': {
        title: 'Ajouter un cadre porte & fenêtre',
        fieldName: 'type_cadre',
        url: '/Admin-Fer/ajouter/cadre'
      },
      'section-grille': {
        title: 'Ajouter un cadre grille de protection',
        fieldName: 'type_cadre',
        url: '/Admin-Fer/ajouter/cadre-grille'
      },
      'section-bati': {
        title: 'Ajouter un bâti',
        fieldName: 'type_bati',
        url: '/Admin-Fer/ajouter/batis'
      },
      'section-decoration': {
        title: 'Ajouter une décoration',
        fieldName: 'type_decoration',
        url: '/Admin-Fer/ajouter/decoration'
      },
      'section-tole': {
        title: 'Ajouter une tôle',
        fieldName: 'type_tole',
        url: '/Admin-Fer/ajouter/toles'
      }
    };

    const config = sectionConfig[sectionId];
    if (config) {
      document.getElementById('addModalLabel').textContent = config.title;

      const typeInput = document.getElementById('type_reference');
      typeInput.setAttribute('name', config.fieldName);
      document.getElementById('addForm').setAttribute('action', config.url);
      document.getElementById('addForm').reset();

      $('#addModal').modal('show');
    }
  });

  const urlParams = new URLSearchParams(window.location.search);
  const activeSection = urlParams.get('section');

  const backendSection = '{{ active_section|default("") }}';

  let initialSection = 'btnradio1';

  if (backendSection && sectionToRadio[backendSection]) {
    initialSection = sectionToRadio[backendSection];
  } else if (activeSection && sectionToRadio[activeSection]) {
    initialSection = sectionToRadio[activeSection];
  }


  const targetRadio = document.getElementById(initialSection);
  if (targetRadio) {
    targetRadio.checked = true;
    targetRadio.closest('label').classList.add('active');
    showSection(initialSection);
  }
});
</script>

{% endblock %}